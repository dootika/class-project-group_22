---
title: "Project Report"
author: "Group 22"
date: "2023-11-09"
output:
  html_document: default
  pdf_document: default
---

```{r}
#| echo: false
#| eval: true
#| warning: false

library(shiny)
library(ggplot2)
library(png)
library(magick)
library(shinyjs)
library(shinyalert)
library(dplyr)
library(shinythemes)
library(gt)
library(plotly)
library(rvest)

load("Data Sets/Cricket.RData")
load("Data Sets/Teams_Table.RData")
load("Data Sets/Cricket_Coord.RData")
happy <- read.csv("Data Sets/Happiness_Index.csv")
gdp <- read.csv("Data Sets/gdp_per_capita.csv")

year <- function(da) {
  return(as.integer(format(da, "%Y")))
}
```


# Introduction

This report provides a detailed analysis of the Shiny app developed for cricket player ODI data . The app is designed to allow users to interact with cricket data in a user-friendly manner, providing insights into player performance, team statistics, match simulations, and more.

## App Overview

The Shiny app consists of Three tabs, each dedicated to a specific aspect of cricket analysis. This section provides an overview of each tab's purpose and functionality.

## Data

Data for the first tab of shiny is in form of list , there are mainly two lists which are named as Player_data and Player_name . In Player_data list data which is scraped is saved in well defined format with respect to player with there country . In Player_name list all player named are saved with respect to there country . The interesting thing in data saving is that the list named are of country name and of player name and in a list there is another list i.e in Player_data list there is a list for country names and in that there is a list named after players. And the same data is used to simulate the Cricket Match .
Data for the second tab is saved in the form of an Rdata called Teams_Table.Rdata, which saves data in the form of a table called table, and a function called team_filter which collects data of all matches which are played by a certain team. That file saves the data of all matches, including the winners, losers, their scores, margins and more. Happiness_Index.csv saves the data of Happiness Index of countries from 2013 to 2023. gdp_per_capita.csv saves data of GDP per Capita of countries.

### Scraping of data

Data for first tab that is a list witch contain batting and bowling data is scraped form a website named as Cricmatric you can go there from [here](http://www.cricmetric.com/index.py). First we formed a function and that give list to the function that is player name list then we got the data in output. Function for batting data can be seen by clicking [here](https://github.com/dootika/class-project-group_22/blob/main/Functions/batting%20scrap%20function.R) and for balling data click [here](https://github.com/dootika/class-project-group_22/blob/main/Functions/scrap%20bowling%20data%20function.R) and for how we combine data in a list to see click [here](https://github.com/dootika/class-project-group_22/blob/main/Functions/how_list_formed.R).

Data stored in Teams_Table.Rdata is scraped from [Cricinfo](http://www.cricmetric.com/index.py) and can be seen by clicking [here](https://github.com/dootika/class-project-group_22/blob/main/Functions/Teams_Data.R). We save the table containing the ODI Matches data, along with a function team_filter, which filters out data of matches played by selected team.



## Player ODI Data

This tab allows users to explore individual player statistics for One Day International (ODI) matches. Users can select a country, choose a player, and specify whether they want to view batting or bowling statistics.

![](pictures/A__Project 1_cricketshiny - Shiny 07-11-2023 13_29_47.png)

-   **Country Selection**: Users can choose a country from a dropdown menu.

-   **Player Selection**: Once a country is selected, users can choose a player from a dynamically generated list of players for that country.

-   **Batting/Bowling Selection**: Users can select whether they want to view batting or bowling statistics.

-   **Player Image**: An image of the selected player is displayed.

-   **Player Data Table**: Detailed statistics of the selected player are presented in a table format. This will be like:-

```{r}
#| echo: false
#| eval: true
#| warning: false
Player_Data$India$`Virat Kohli`$Batting[2]
```

-   **Player Performance Plot**: A plot visualizing the player's performance is displayed. Like this :-

```{r}
#| echo: false
#| eval: true
Player_Data$India$`Virat Kohli`$Batting[3]
```

## Team ODI Data

### World View

This sub-tab provides a global perspective of ODI match outcomes. Users can adjust the year range to view trends over time.

-   **Year Selection Slider**: Users can adjust the range of years they want to analyze.
-   **World Map Plot**: Users can visualise the Win to Loss Ratio of each team, color coded, in a time frame.
![](pictures/World_Slider.png){width=400}

```{r}
#| echo: false
#| eval: true
#| warning: false
teams <- unique(table$Loser)[c(1:6, 8:19, 24:28)]
W_L <- NULL
t <- table %>% filter((year(`Match Date`) >= 1971) & (year(`Match Date`) <= 2023))
for (i in 1:length(teams)) {
  win <- sum(t$Winner == teams[i])
  loss <- sum(t$Loser == teams[i])
  if (loss == 0) {
    W_L <- append(W_L, NA)
  }
  else {
    W_L <- append(W_L, win/loss)
  }
}
WL <- data.frame(teams, W_L)
data <- left_join(coord, WL, by = "teams")
ggplot(data, aes(x = long, y = lat, group = group)) + geom_polygon(aes(fill = W_L), color = "black")
```


-   **Table**: Users can see Win to Loss Ratio of all teams who have played ODI cricket in the specified timeframe.

```{r}
#| echo: false
#| eval: true

teams <- unique(table$Loser)[c(1:6, 8:19, 24:28)]
W_L <- NULL
t <- table %>% filter((year(`Match Date`) >= 1971) & (year(`Match Date`) <= 2023))
for (i in 1:length(teams)) {
  win <- sum(t$Winner == teams[i])
  loss <- sum(t$Loser == teams[i])
  if (loss == 0) {
    W_L <- append(W_L, NA)
  }
  else {
    W_L <- append(W_L, win/loss)
  }
}
WL <- data.frame(teams, W_L)
colnames(WL)[1] <- "Teams"
colnames(WL)[2] <- "Win to Loss Ratio"
x <- as_tibble(WL %>% arrange(desc(W_L)) %>% filter(!is.na(W_L)))
x
```



### Team Overview

This sub-tab allows users to select a specific team and view a summary of their performance over selected years.

-   **Team Selection Dropdown**: Users can choose their ODI team from a dropdown menu.
-   **Year Range Slider**: Users can specify the range of years they want to analyze.
     ![](pictures/Team_Summary_Input.png){width="400"}

-   **Team Summary**: 
```{r}
#| echo: false
#| eval: true

t <- team_filter("Australia")
t1 <- (t %>% filter((as.integer(year(t$'Match Date')) >= 1971) & (as.integer(year(t$'Match Date')) <= 2023)))
colnames(t1)[4] <- paste0("Australia Score")
colnames(t1)[5] <- "Opponent Score"
colnames(t1)[8] <- "Winning Score"
colnames(t1)[9] <- "Losing Score"
t1 <- t1[c(4, 5, 8, 9, 12)]
summary(t1)
```

-   **Head-to-Head Table**: Users can see how the selected teams performs against other teams.
```{r}
#| echo: false
#| eval: true
t2 <- team_filter("Australia")
team <- "Australia"
t <- t2 %>% filter((as.integer(year(t2$'Match Date')) >= 1971) & (as.integer(year(t2$'Match Date')) <= 2023))
Team <- unique(t$Opponent)
other <- Team
Won <- NULL
Lost <- NULL
Won_Bat <- NULL
Won_Bowl <- NULL
Lost_Bat <- NULL
Lost_Bowl <- NULL
for (i in 1:length(other)) {
  t1 <- t %>% filter(Opponent == other[i])
  Won <- append(Won, length((t1 %>% filter(Winner == team))$Winner))
  Won_Bat <- append(Won_Bat, length((t1 %>% filter((Winner == team) & (Winning_Innings == "Batting")))$Winner))
  Won_Bowl <- append(Won_Bowl, length((t1 %>% filter((Winner == team) & (Winning_Innings == "Bowling")))$Winner))
  Lost_Bat <- append(Lost_Bat, length((t1 %>% filter((Winner == other[i]) & (Winning_Innings == "Bowling")))$Winner))
  Lost_Bowl <- append(Lost_Bowl, length((t1 %>% filter((Winner == other[i]) & (Winning_Innings == "Batting")))$Winner))
  Lost <- append(Lost, length((t1 %>% filter(Winner == other[i]))$Winner))
}
    
d <- data.frame(Team, Won_Bat, Lost_Bat, Won_Bowl, Lost_Bowl, Won/Lost)
colnames(d)[6] <- "W_L Ratio"
d$'W_L Ratio'[is.infinite(d$'W_L Ratio')] <- NA
d$'W_L Ratio' <- as.double(d$'W_L Ratio')
d <- d %>% arrange(desc(d$'W_L Ratio'))
colnames(d)[6] <- "Win to Loss Ratio"
d <- gt(d)
tab <- tab_spanner(d, label = "Batting", columns = ends_with("Bat"))
tab <- tab_spanner(tab, label = "Chasing", columns = ends_with("Bowl"))
tab |> cols_label(starts_with("Won") ~ "Won", starts_with("Lost") ~ "Lost")
```
     

### Match Up

This sub-tab enables users to compare the performance of two selected teams over a specified year range.

-   **Team 1 Selection Dropdown**: Users can choose the first team from a dropdown menu.
-   **Team 2 Selection Dropdown**: Users can choose the second team from a dropdown menu.
-   **Year Range Slider**: Users can specify the range of years they want to analyze.
-   **Match Summary**: A summary of the matches when the two teams are playing each other.
```{r}
#| echo: false
#| eval: true

t <- team_filter("Australia") %>% filter(Opponent == "England")
t <- t %>% filter((year(`Match Date`) >= 1971) & (year(`Match Date`) <= 2023))
colnames(t)[4] <- paste0("Australia Score")
colnames(t)[5] <- paste0("England Score")
colnames(t)[8] <- "Winning Score"
colnames(t)[9] <- "Losing Score"
t <- t[c(4, 5, 8, 9, 12)]
summary(t)
```
     
-   **Match Up Plot**: Users can see a plot of how the teams score when playing one another.
```{r}
#| echo: false
#| eval: true

y1 <- 1971
y2 <- 2023
t1 <- "Australia"
t2 <- "England"
tf <- team_filter(t1)
tab <- tf %>% filter((as.integer(year(tf$'Match Date')) <= y2) & (as.integer(year(tf$'Match Date')) >= y1)) %>% filter(Opponent == t2)
Date <- NULL
Score <- NULL
Team <- NULL
    
for (i in 1:length(tab$Winner)) {
  if (tab$Winner[i] == t1) {
    Date <- append(Date, tab$'Match Date'[i])
    Date <- append(Date, tab$'Match Date'[i])
    Score <- append(Score, tab$Winner_Score[i])
    Score <- append(Score, tab$Loser_Score[i])
    Team <- append(Team, t1)
    Team <- append(Team, t2)
  }
  if (tab$Winner[i] == t2) {
    Date <- append(Date, tab$'Match Date'[i])
    Date <- append(Date, tab$'Match Date'[i])
    Score <- append(Score, tab$Loser_Score[i])
    Score <- append(Score, tab$Winner_Score[i])
    Team <- append(Team, t1)
    Team <- append(Team, t2)
  }
}
t <- data.frame(Date, Score, Team)
ggplot(t, aes(x = Date, y = Score, col = Team)) + geom_point()
```
     
-   **Match Up Table**: Users can see who won how many matches in their previous encounters, and in which innings.
```{r}
y1 <- 1971
y2 <- 2023
t1 <- "Australia"
t2 <- "England"
tf <- team_filter(t1)
tab <- tf %>% filter((as.integer(year(tf$'Match Date')) <= y2) & (as.integer(year(tf$'Match Date')) >= y1)) %>% filter(Opponent == t2)
Team_1_Batting <- length((tab %>% filter(Winner == t1) %>% filter(Winning_Innings == "Batting"))$Winner)
Team_1_Bowling <- length((tab %>% filter(Winner == t1) %>% filter(Winning_Innings == "Bowling"))$Winner)
Team_2_Batting <- length((tab %>% filter(Winner == t2) %>% filter(Winning_Innings == "Batting"))$Winner)
Team_2_Bowling <- length((tab %>% filter(Winner == t2) %>% filter(Winning_Innings == "Bowling"))$Winner)
Innings <- c("Batting", "Bowling")
Team_1 <- c(Team_1_Batting, Team_1_Bowling)
Team_2 <- c(Team_2_Batting, Team_2_Bowling)
tb <- data.frame(Innings, Team_1, Team_2)
colnames(tb)[2] <- paste0(t1)
colnames(tb)[3] <- paste0(t2)
tb
```

### Happiness Index

This sub-tab provides insights into the correlation between a country's happiness index and its cricket team's performance.

-   **General View**: This view is to show the correlation of Happiness Index with the Win to Loss Ratio of the selected countries.
      ![](pictures/Happiness_General_Input.png){width="400"}
```{r}
#| echo: false
#| eval: true
Countries <- c("Australia", "Pakistan", "New Zealand", "India", "Sri Lanka", "Zimbabwe", "Bangladesh", "South Africa", "Netherlands", "Kenya", "Ireland", "Afghanistan")
Correlation <- NULL
for (c in Countries) {
  tab <- happy %>% filter(Country == c)
  Tf <- team_filter(c)
  y_team <- unique(year(Tf$'Match Date'))
  Year <- NULL
  for (i in unique(tab$Year)) {
    if (i %in% unique(year(Tf$'Match Date'))) {
      Year <- append(Year, i)
    }
  }
  Happiness <- NULL
  Win_To_Loss <- NULL
  for (i in Year) {
    hap <- tab$Index[which(tab$Year == i, arr.ind = TRUE)]
    Happiness <- append(Happiness, as.double(hap))
    Win <- length((Tf %>% filter(Winner == c) %>% filter(year(`Match Date`) == i))$Winner)
    Loss <- length((Tf %>% filter(Loser == c) %>% filter(year(`Match Date`) == i))$Loser)
    if (Loss == 0) {
      Win_To_Loss <- append(Win_To_Loss, Win)
    }
    else {
      Win_To_Loss <- append(Win_To_Loss, Win/Loss)
    }
  }
  Correlation <- append(Correlation, cor(Win_To_Loss, Happiness))
}
barplot(names = Countries, height = Correlation, xlab = "Countries", ylab = "Correlation")
```
      
-   **Country-Specific View**: This view can be used to visualise the variation of Happiness Index and Win to Loss Ratio of the selected country with year.

    ![](pictures/Hap_Team_Input.png){width="400"}
```{r}
#| echo: false
#| eval: true

y1 <- happy %>% filter(Country == "India")
y2 <- team_filter("India")
Year <- NULL
for (i in unique(y1$Year)) {
  if (i %in% unique(year(y2$'Match Date'))) {
    Year <- append(Year, i)
  }
}
Win_To_Loss <- NULL
Happiness <- NULL
for (i in Year) {
  hap <- y1$Index[which(y1$Year == i, arr.ind = TRUE)]
  Happiness <- append(Happiness, as.double(hap))
  Win <- length((y2 %>% filter(Winner == "India") %>% filter(year(`Match Date`) == i))$Winner)
  Loss <- length((y2 %>% filter(Loser == "India") %>% filter(year(`Match Date`) == i))$Loser)
  if (Loss == 0) {
    Win_To_Loss <- append(Win_To_Loss, Win)
  }
  else {
    Win_To_Loss <- append(Win_To_Loss, Win/Loss)
  }
}
matplot(Year, cbind(Happiness, Win_To_Loss), col = c("red", "blue"), pch = c(13, 16), xlab = "Year", ylab = "Happiness Index + Win To Loss Ratio")
legend("topright", legend = c("Happiness Index", "Win To Loss Ratio"), col = c("red", "blue"), pch = c(13, 16))
```
    

### GDP

This sub-tab explores the correlation between a country's Gross Domestic Product (GDP) and its cricket team's performance.

-   **General View**: This view is to show the correlation of GDP with the Win to Loss Ratio of the selected countries.

      ![](pictures/GDP_General_Input.png){width="400"}
```{r}
#| echo: false
#| eval: true
Countries <- c("Australia", "Pakistan", "New Zealand", "India", "Sri Lanka", "Zimbabwe", "Bangladesh", "South Africa", "Netherlands", "Kenya", "Ireland", "Afghanistan")
Correlation <- NULL
for (c in Countries) {
  tab <- gdp %>% filter(Country.Name == c)
  Tf <- team_filter(c)
  y_team <- unique(year(Tf$'Match Date'))
  Years <- NULL
  for (i in 1960:2020) {
    if (!is.na(tab[i - 1957] == "NA") & (as.integer(i) %in% y_team)) {
      Years <- append(Years, as.integer(i))
    }
  }
  GDP <- NULL
  Win_To_Loss <- NULL
  for (i in Years) {
    GDP <- append(GDP, as.integer(tab[i - 1957]))
    Win <- length((Tf %>% filter(Winner == c) %>% filter(year(`Match Date`) == i))$Winner)
    Loss <- length((Tf %>% filter(Loser == c) %>% filter(year(`Match Date`) == i))$Loser)
    if (Loss == 0) {
      Win_To_Loss <- append(Win_To_Loss, Win)
    }
    else {
      Win_To_Loss <- append(Win_To_Loss, Win/Loss)
    }
  }
  Correlation <- append(Correlation, cor(Win_To_Loss, GDP))
}
barplot(names = Countries, height = Correlation, xlab = "Countries", ylab = "Correlation")
```
      

-   **Country-Specific View**: This view can be used to visualise the variation of GDP and Win to Loss Ratio of the selected country with year.

    ![](pictures/GDP_Team_Input.png){width="400"}

```{r}
#| echo: false
#| eval: true

t1 <- "India"
tab <- gdp %>% filter(Country.Name == t1)
Tf <- team_filter(t1)
y_team <- unique(year(Tf$'Match Date'))
Years <- NULL
for (i in 1960:2020) {
  if (!is.na(tab[i - 1957] == "NA") & (as.integer(i) %in% y_team)) {
    Years <- append(Years, as.integer(i))
  }
}
GDP <- NULL
Win_To_Loss <- NULL
for (i in Years) {
  GDP <- append(GDP, as.integer(tab[i - 1957]))
  Win <- length((Tf %>% filter(Winner == t1) %>% filter(year(`Match Date`) == i))$Winner)
  Loss <- length((Tf %>% filter(Loser == t1) %>% filter(year(`Match Date`) == i))$Loser)
  if (Loss == 0) {
    Win_To_Loss <- append(Win_To_Loss, Win)
  }
  else {
    Win_To_Loss <- append(Win_To_Loss, Win/Loss)
  }
}
matplot(Years, cbind(GDP, 1000*Win_To_Loss), col = c("red", "blue"), pch = c(13, 16), xlab = "Years", ylab = "GDP + Win To Loss Ratio(x 1000)")
legend("topright", legend = c("GDP per Capita", "Win To Loss Ratio(x 1000)"), col = c("red", "blue"), pch = c(13, 16))
```
   

## Cricket Match

This tab allows users to simulate a cricket match between two teams. Users can select existing teams or create custom teams by choosing players.

![](pictures/A__Project 1_cricketshiny - Shiny 07-11-2023 13_33_07.png){width="500"}

![](pictures/A__Project 1_cricketshiny - Shiny 07-11-2023 13_33_15.png){width="500"}

-   **Team Selection**: Users can choose existing teams or create new teams by selecting players.
-   **Player Selection**: Users can select players for the teams.
-   **Start Match Button**: Initiates the match simulation.
-   **Match Outcome**: Displays the results of the simulated match, including scores, batting, and bowling performances.Outcome will be of batting data table and there visualisation as follows :-

```{r}
#| echo: false
#| eval: true
data <- Cricket_Match(Player_Data$Afghanistan,Player_Data$India,Player_name$Afghanistan,Player_name$India)
data
```

```{r}
#| echo: false
#| eval: true
 p <-  ggplot(data[[1]][[1]], aes(x = batsman_name, y = Runs, col = factor(four), size = six , shape = batsman_outer)) + 
        geom_point() + 
        labs(title ="Batsman Performance" ,x = "Batsman Name", y = "Total Runs", 
             shape = "Wicketeer", color = "No of Four", size = "No of Six") +
        theme(axis.text.x = element_text(angle = 45, hjust = 1),legend.position = "none")
      ggplotly(p, tooltip = c("batsman_name", "Runs", "four", "six", "batsman_outer"))
```

```{r}
#| echo: false
#| eval: true
  ggplot(data[[1]][[2]], aes(x = "", y = Runs, fill = Baller_name)) +
        geom_bar(width = 1, stat = "identity", color = "black") +
        geom_text(aes(label = paste(Baller_name, "\n", "Wickets:", Wicket,"\n","Runs:" , Runs)), 
                  position = position_stack(vjust = 0.5), size = 3, vjust = 1, color = "white") +
        coord_polar("y") +
        theme_minimal() +  # Change the theme to minimal
        theme(
          legend.position = "none",
          axis.text.x = element_blank(),  # Remove x-axis text
          panel.grid = element_blank(),   # Remove grid lines
          plot.background = element_rect(fill = "lightblue"),  # Change plot background color
          panel.background = element_rect(fill = "white"),     # Change panel background color
          axis.line = element_line(color = "black"),           # Add a border around the plot
          plot.title = element_text(hjust = 0.5, size = 16),   # Center the title and increase font size
          axis.title = element_text(size = 1),                # Increase axis label font size
          axis.text.y = element_text(size = 10)    )            # Increase y-axis text font size
```

# Code Evaluation

The R code for the Shiny app demonstrates proficiency in utilizing the Shiny package, data manipulation, and visualization techniques. The app's functionality is well-organized, allowing for seamless interaction with the cricket data. You can find codes here.[Click here](https://github.com/dootika/class-project-group_22)

## Interesting data-driven questions to think about

-   What is the correlation between a country's performance and its GDP and its Happiness index?

-   Can i get a visual representations of data using graphs and chart?

-   Can I view a team's recent performance statistics, such as recent form and trends?

-   How can I access a summary of each previous encounter between two sides in the app?

-   Can I filter match history by specific teams, years, or tournaments?

-   Is there a feature to watch or re-enact classic matches from the past?

-   Can I find the win-loss ratio for different countries participating in the ODI World Cup?

-   Are historical statistics and records available for past World Cup tournaments?

-   Can I choose between default teams or create a custom team with my favorite players?

-   What level of control and customization is available during the match simulation?


# Conclusion

Access to individual player information throughout their career is a fantastic feature, especially for cricket fans who want to dig deep into player statistics and achievements. This can improve the overall cricketing experience. The ability to run live simulations with default teams or custom lineups is an appealing feature. It allows users to test strategies, create dream teams, and experience the excitement of live matches within the app. Displaying win-loss ratios for different countries in the ODI World Cup adds a competitive element to the app. Users can compare their customized team's performance to that of real-world national teams. Being capable to access summaries of previous encounters between two sides provides historical context. It allows users to research rivalries and historical events in cricket. Viewing a team's past performance, along with graphs, is a useful feature for those interested in in-depth analysis. It enables users to make data-driven decisions and understand team trends. It's interesting to see the correlation between GDP per capita, Happiness Index, and win-loss ratios of World Cup countries. It gives the app an educational and analytical dimension, appealing to users who are interested in the broader societal impact on sports performance.
